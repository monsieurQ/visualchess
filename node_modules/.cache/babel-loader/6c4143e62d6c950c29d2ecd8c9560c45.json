{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime-corejs2/helpers/interopRequireDefault\");\n\nvar _Object$defineProperty = require(\"@babel/runtime-corejs2/core-js/object/define-property\");\n\nvar _Reflect$construct = require(\"@babel/runtime-corejs2/core-js/reflect/construct\");\n\n_Object$defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports[\"default\"] = exports.RookValidation = exports.QueenValidation = exports.PawnValidation = exports.KnightValidation = exports.KingValidation = exports.BishopValidation = exports.PieceValidation = void 0;\n\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/inherits\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/getPrototypeOf\"));\n\nvar _promise = _interopRequireDefault(require(\"@babel/runtime-corejs2/core-js/promise\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/createClass\"));\n\nvar _piece = require(\"./piece\");\n\nvar _board = require(\"./board\");\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = (0, _getPrototypeOf2[\"default\"])(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = (0, _getPrototypeOf2[\"default\"])(this).constructor;\n      result = _Reflect$construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return (0, _possibleConstructorReturn2[\"default\"])(this, result);\n  };\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !_Reflect$construct) return false;\n  if (_Reflect$construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(_Reflect$construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nvar PieceValidation = /*#__PURE__*/function () {\n  function PieceValidation(board) {\n    (0, _classCallCheck2[\"default\"])(this, PieceValidation);\n    this.allowBackward = false;\n    this.allowDiagonal = false;\n    this.allowForward = false;\n    this.allowHorizontal = false;\n    this.board = board;\n    this.type = null;\n    this.repeat = 0;\n  }\n\n  (0, _createClass2[\"default\"])(PieceValidation, [{\n    key: \"applySpecialValidation\",\n    value: function applySpecialValidation() {// do nothing...\n      // overridden in the concrete validation classes\n      // where special logic is required\n    }\n  }, {\n    key: \"start\",\n    value: function start(src, callback) {\n      // ensure callback is set\n      callback = callback || function (err, destinationSquares) {\n        return new _promise[\"default\"](function (resolve, reject) {\n          if (err) {\n            return reject(err);\n          }\n\n          return resolve(destinationSquares);\n        });\n      };\n\n      var opt = {\n        destSquares: [],\n        origin: src,\n        piece: src ? src.piece : null\n      };\n\n      var findMoveOptions = function findMoveOptions(b, r, n) {\n        var block = false,\n            capture = false,\n            currentSquare = b.getNeighborSquare(opt.origin, n),\n            i = 0;\n\n        while (currentSquare && i < r) {\n          block = currentSquare.piece !== null && (opt.piece.type === _piece.PieceType.Pawn || currentSquare.piece.side === opt.piece.side);\n          capture = currentSquare.piece && !block;\n\n          if (!block) {\n            opt.destSquares.push(currentSquare);\n          }\n\n          if (capture || block) {\n            currentSquare = null;\n          } else {\n            currentSquare = b.getNeighborSquare(currentSquare, n);\n            i++;\n          }\n        }\n      };\n\n      if (!opt.piece || opt.piece.type !== this.type) {\n        return callback(new Error('piece is invalid'));\n      }\n\n      if (this.board && opt.origin) {\n        // forward squares\n        if (this.allowForward) {\n          findMoveOptions(this.board, this.repeat, opt.piece.side === _piece.SideType.White ? _board.NeighborType.Above : _board.NeighborType.Below);\n        } // backward squares\n\n\n        if (this.allowBackward) {\n          findMoveOptions(this.board, this.repeat, opt.piece.side === _piece.SideType.White ? _board.NeighborType.Below : _board.NeighborType.Above);\n        } // horizontal squares\n\n\n        if (this.allowHorizontal) {\n          findMoveOptions(this.board, this.repeat, _board.NeighborType.Left);\n          findMoveOptions(this.board, this.repeat, _board.NeighborType.Right);\n        } // diagonal squares\n\n\n        if (this.allowDiagonal) {\n          findMoveOptions(this.board, this.repeat, _board.NeighborType.AboveLeft);\n          findMoveOptions(this.board, this.repeat, _board.NeighborType.BelowRight);\n          findMoveOptions(this.board, this.repeat, _board.NeighborType.BelowLeft);\n          findMoveOptions(this.board, this.repeat, _board.NeighborType.AboveRight);\n        } // apply additional validation logic\n\n\n        this.applySpecialValidation(opt); // callback\n\n        return callback(null, opt.destSquares);\n      }\n\n      return callback(new Error('board is invalid'));\n    }\n  }], [{\n    key: \"create\",\n    value: function create(piece, board) {\n      switch (piece) {\n        case _piece.PieceType.Bishop:\n          return new BishopValidation(board);\n\n        case _piece.PieceType.King:\n          return new KingValidation(board);\n\n        case _piece.PieceType.Knight:\n          return new KnightValidation(board);\n\n        case _piece.PieceType.Pawn:\n          return new PawnValidation(board);\n\n        case _piece.PieceType.Queen:\n          return new QueenValidation(board);\n\n        case _piece.PieceType.Rook:\n          return new RookValidation(board);\n\n        default:\n          return null;\n      }\n    }\n  }]);\n  return PieceValidation;\n}();\n\nexports.PieceValidation = PieceValidation;\n\nvar BishopValidation = /*#__PURE__*/function (_PieceValidation) {\n  (0, _inherits2[\"default\"])(BishopValidation, _PieceValidation);\n\n  var _super = _createSuper(BishopValidation);\n\n  function BishopValidation(board) {\n    var _this;\n\n    (0, _classCallCheck2[\"default\"])(this, BishopValidation);\n    _this = _super.call(this, board); // base validation properties\n\n    _this.allowDiagonal = true;\n    _this.type = _piece.PieceType.Bishop;\n    _this.repeat = 8;\n    return _this;\n  }\n\n  return BishopValidation;\n}(PieceValidation);\n\nexports.BishopValidation = BishopValidation;\n\nvar KingValidation = /*#__PURE__*/function (_PieceValidation2) {\n  (0, _inherits2[\"default\"])(KingValidation, _PieceValidation2);\n\n  var _super2 = _createSuper(KingValidation);\n\n  function KingValidation(board) {\n    var _this2;\n\n    (0, _classCallCheck2[\"default\"])(this, KingValidation);\n    _this2 = _super2.call(this, board); // base validation properties\n\n    _this2.allowBackward = true;\n    _this2.allowDiagonal = true;\n    _this2.allowForward = true;\n    _this2.allowHorizontal = true;\n    _this2.type = _piece.PieceType.King;\n    _this2.repeat = 1;\n    return _this2;\n  }\n\n  (0, _createClass2[\"default\"])(KingValidation, [{\n    key: \"applySpecialValidation\",\n    value: function applySpecialValidation() {// check for castle?\n    }\n  }]);\n  return KingValidation;\n}(PieceValidation);\n\nexports.KingValidation = KingValidation;\n\nvar KnightValidation = /*#__PURE__*/function (_PieceValidation3) {\n  (0, _inherits2[\"default\"])(KnightValidation, _PieceValidation3);\n\n  var _super3 = _createSuper(KnightValidation);\n\n  function KnightValidation(board) {\n    var _this3;\n\n    (0, _classCallCheck2[\"default\"])(this, KnightValidation);\n    _this3 = _super3.call(this, board); // base validation properties\n\n    _this3.type = _piece.PieceType.Knight;\n    _this3.repeat = 1;\n    return _this3;\n  }\n\n  (0, _createClass2[\"default\"])(KnightValidation, [{\n    key: \"applySpecialValidation\",\n    value: function applySpecialValidation(opt) {\n      // add knight move options\n      var aboveLeft = this.board.getNeighborSquare(opt.origin, _board.NeighborType.AboveLeft),\n          aboveRight = this.board.getNeighborSquare(opt.origin, _board.NeighborType.AboveRight),\n          belowLeft = this.board.getNeighborSquare(opt.origin, _board.NeighborType.BelowLeft),\n          belowRight = this.board.getNeighborSquare(opt.origin, _board.NeighborType.BelowRight),\n          i = 0,\n          p = null,\n          squares = [];\n\n      if (aboveLeft) {\n        squares.push(this.board.getNeighborSquare(aboveLeft, _board.NeighborType.Above));\n        squares.push(this.board.getNeighborSquare(aboveLeft, _board.NeighborType.Left));\n      }\n\n      if (aboveRight) {\n        squares.push(this.board.getNeighborSquare(aboveRight, _board.NeighborType.Above));\n        squares.push(this.board.getNeighborSquare(aboveRight, _board.NeighborType.Right));\n      }\n\n      if (belowLeft) {\n        squares.push(this.board.getNeighborSquare(belowLeft, _board.NeighborType.Below));\n        squares.push(this.board.getNeighborSquare(belowLeft, _board.NeighborType.Left));\n      }\n\n      if (belowRight) {\n        squares.push(this.board.getNeighborSquare(belowRight, _board.NeighborType.Below));\n        squares.push(this.board.getNeighborSquare(belowRight, _board.NeighborType.Right));\n      }\n\n      for (i = 0; i < squares.length; i++) {\n        if (squares[i]) {\n          // check for enemy piece on square\n          p = squares[i] ? squares[i].piece : null;\n\n          if (!p || p.side !== opt.piece.side) {\n            opt.destSquares.push(squares[i]);\n          }\n        }\n      }\n    }\n  }]);\n  return KnightValidation;\n}(PieceValidation);\n\nexports.KnightValidation = KnightValidation;\n\nvar PawnValidation = /*#__PURE__*/function (_PieceValidation4) {\n  (0, _inherits2[\"default\"])(PawnValidation, _PieceValidation4);\n\n  var _super4 = _createSuper(PawnValidation);\n\n  function PawnValidation(board) {\n    var _this4;\n\n    (0, _classCallCheck2[\"default\"])(this, PawnValidation);\n    _this4 = _super4.call(this, board); // base validation properties\n\n    _this4.allowForward = true;\n    _this4.type = _piece.PieceType.Pawn;\n    _this4.repeat = 1;\n    return _this4;\n  }\n  /* eslint no-magic-numbers:0 */\n\n\n  (0, _createClass2[\"default\"])(PawnValidation, [{\n    key: \"applySpecialValidation\",\n    value: function applySpecialValidation(opt) {\n      // check for capture\n      var i = 0,\n          p = null,\n          sq = null,\n          squares = [this.board.getNeighborSquare(opt.origin, opt.piece.side === _piece.SideType.White ? _board.NeighborType.AboveLeft : _board.NeighborType.BelowLeft), this.board.getNeighborSquare(opt.origin, opt.piece.side === _piece.SideType.White ? _board.NeighborType.AboveRight : _board.NeighborType.BelowRight)]; // check for capture\n\n      for (i = 0; i < squares.length; i++) {\n        // check for enemy piece on square\n        p = squares[i] ? squares[i].piece : null;\n\n        if (p && p.side !== opt.piece.side) {\n          opt.destSquares.push(squares[i]);\n        }\n      } // check for double square first move\n\n\n      if (opt.piece.moveCount === 0 && opt.destSquares.length && // Fix for issue #15 (originally looked for length of 1)\n      opt.destSquares[0].piece === null) {\n        // Fix for issue #1\n        sq = this.board.getNeighborSquare(opt.destSquares[0], opt.piece.side === _piece.SideType.White ? _board.NeighborType.Above : _board.NeighborType.Below);\n\n        if (!sq.piece) {\n          opt.destSquares.push(sq);\n        } // check for en passant\n\n      } else if (opt.origin.rank === (opt.piece.side === _piece.SideType.White ? 5 : 4)) {\n        // get squares left & right of pawn\n        squares = [this.board.getNeighborSquare(opt.origin, _board.NeighborType.Left), this.board.getNeighborSquare(opt.origin, _board.NeighborType.Right)];\n        i = 0;\n\n        for (i = 0; i < squares.length; i++) {\n          // check for pawn on square\n          p = squares[i] ? squares[i].piece : null;\n\n          if (p && p.type === _piece.PieceType.Pawn && p.side !== opt.piece.side && p.moveCount === 1 && this.board.lastMovedPiece === p) {\n            opt.destSquares.push(this.board.getNeighborSquare(squares[i], p.side === _piece.SideType.Black ? _board.NeighborType.Above : _board.NeighborType.Below));\n          }\n        }\n      }\n    }\n  }]);\n  return PawnValidation;\n}(PieceValidation);\n\nexports.PawnValidation = PawnValidation;\n\nvar QueenValidation = /*#__PURE__*/function (_PieceValidation5) {\n  (0, _inherits2[\"default\"])(QueenValidation, _PieceValidation5);\n\n  var _super5 = _createSuper(QueenValidation);\n\n  function QueenValidation(board) {\n    var _this5;\n\n    (0, _classCallCheck2[\"default\"])(this, QueenValidation);\n    _this5 = _super5.call(this, board); // base validation properties\n\n    _this5.allowBackward = true;\n    _this5.allowDiagonal = true;\n    _this5.allowForward = true;\n    _this5.allowHorizontal = true;\n    _this5.repeat = 8;\n    _this5.type = _piece.PieceType.Queen;\n    return _this5;\n  }\n\n  return QueenValidation;\n}(PieceValidation);\n\nexports.QueenValidation = QueenValidation;\n\nvar RookValidation = /*#__PURE__*/function (_PieceValidation6) {\n  (0, _inherits2[\"default\"])(RookValidation, _PieceValidation6);\n\n  var _super6 = _createSuper(RookValidation);\n\n  function RookValidation(board) {\n    var _this6;\n\n    (0, _classCallCheck2[\"default\"])(this, RookValidation);\n    _this6 = _super6.call(this, board); // base validation properties\n\n    _this6.allowBackward = true;\n    _this6.allowForward = true;\n    _this6.allowHorizontal = true;\n    _this6.repeat = 8;\n    _this6.type = _piece.PieceType.Rook;\n    return _this6;\n  }\n\n  return RookValidation;\n}(PieceValidation);\n\nexports.RookValidation = RookValidation;\nvar _default = {\n  PieceValidation: PieceValidation\n};\nexports[\"default\"] = _default;","map":{"version":3,"sources":["pieceValidation.js"],"names":["PieceValidation","piece","board","PieceType","src","callback","reject","resolve","opt","destSquares","origin","findMoveOptions","block","capture","currentSquare","b","i","SideType","NeighborType","BishopValidation","KingValidation","KnightValidation","aboveLeft","aboveRight","belowLeft","belowRight","p","squares","PawnValidation","sq","QueenValidation","RookValidation"],"mappings":"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","sourcesContent":["/**\n\tThe general idea behind PieceValidation is to examine an individual piece\n\tand determine (with the information available from about that single piece)\n\twhat move options are available for that piece.\n\n\tThe PieceValidation doesn't alter any properties of the piece, the board\n\tor any squares. Additionally, the PieceValidation is suitable for 1 phase of\n\tthe evaluation of viable move options for a piece... the BoardValidation\n\tcomponent handles the overall evaluation of what moves are possible for the\n\tboard in its current state.\n*/\nimport { PieceType, SideType } from './piece';\nimport { NeighborType } from './board';\n\nexport class PieceValidation {\n\tconstructor (board) {\n\t\tthis.allowBackward = false;\n\t\tthis.allowDiagonal = false;\n\t\tthis.allowForward = false;\n\t\tthis.allowHorizontal = false;\n\t\tthis.board = board;\n\t\tthis.type = null;\n\t\tthis.repeat = 0;\n\t}\n\n\tapplySpecialValidation () {\n\t\t// do nothing...\n\t\t// overridden in the concrete validation classes\n\t\t// where special logic is required\n\t}\n\n\tstatic create (piece, board) {\n\t\tswitch (piece) {\n\t\t\tcase PieceType.Bishop:\n\t\t\t\treturn new BishopValidation(board);\n\t\t\tcase PieceType.King:\n\t\t\t\treturn new KingValidation(board);\n\t\t\tcase PieceType.Knight:\n\t\t\t\treturn new KnightValidation(board);\n\t\t\tcase PieceType.Pawn:\n\t\t\t\treturn new PawnValidation(board);\n\t\t\tcase PieceType.Queen:\n\t\t\t\treturn new QueenValidation(board);\n\t\t\tcase PieceType.Rook:\n\t\t\t\treturn new RookValidation(board);\n\t\t\tdefault:\n\t\t\t\treturn null;\n\t\t}\n\t}\n\n\tstart (src, callback) {\n\t\t// ensure callback is set\n\t\tcallback = callback || ((err, destinationSquares) => new Promise((resolve, reject) => {\n\t\t\tif (err) {\n\t\t\t\treturn reject(err);\n\t\t\t}\n\n\t\t\treturn resolve(destinationSquares);\n\t\t}));\n\n\t\tlet opt = {\n\t\t\tdestSquares : [],\n\t\t\torigin : src,\n\t\t\tpiece : src ? src.piece : null\n\t\t};\n\n\t\tconst findMoveOptions = function (b, r, n) {\n\t\t\tlet\n\t\t\t\tblock = false,\n\t\t\t\tcapture = false,\n\t\t\t\tcurrentSquare = b.getNeighborSquare(opt.origin, n),\n\t\t\t\ti = 0;\n\n\t\t\twhile (currentSquare && i < r) {\n\t\t\t\tblock = currentSquare.piece !== null &&\n\t\t\t\t\t(opt.piece.type === PieceType.Pawn ||\n\t\t\t\t\t\tcurrentSquare.piece.side === opt.piece.side);\n\t\t\t\tcapture = (currentSquare.piece && !block);\n\n\t\t\t\tif (!block) {\n\t\t\t\t\topt.destSquares.push(currentSquare);\n\t\t\t\t}\n\n\t\t\t\tif (capture || block) {\n\t\t\t\t\tcurrentSquare = null;\n\t\t\t\t} else {\n\t\t\t\t\tcurrentSquare = b.getNeighborSquare(currentSquare, n);\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tif (!opt.piece || opt.piece.type !== this.type) {\n\t\t\treturn callback(new Error('piece is invalid'));\n\t\t}\n\n\t\tif (this.board && opt.origin) {\n\t\t\t// forward squares\n\t\t\tif (this.allowForward) {\n\t\t\t\tfindMoveOptions(this.board, this.repeat,\n\t\t\t\t\topt.piece.side === SideType.White ?\n\t\t\t\t\t\t\tNeighborType.Above :\n\t\t\t\t\t\t\tNeighborType.Below);\n\t\t\t}\n\n\t\t\t// backward squares\n\t\t\tif (this.allowBackward) {\n\t\t\t\tfindMoveOptions(this.board, this.repeat,\n\t\t\t\t\topt.piece.side === SideType.White ?\n\t\t\t\t\t\t\tNeighborType.Below :\n\t\t\t\t\t\t\tNeighborType.Above);\n\t\t\t}\n\n\t\t\t// horizontal squares\n\t\t\tif (this.allowHorizontal) {\n\t\t\t\tfindMoveOptions(this.board, this.repeat, NeighborType.Left);\n\t\t\t\tfindMoveOptions(this.board, this.repeat, NeighborType.Right);\n\t\t\t}\n\n\t\t\t// diagonal squares\n\t\t\tif (this.allowDiagonal) {\n\t\t\t\tfindMoveOptions(this.board, this.repeat, NeighborType.AboveLeft);\n\t\t\t\tfindMoveOptions(this.board, this.repeat, NeighborType.BelowRight);\n\t\t\t\tfindMoveOptions(this.board, this.repeat, NeighborType.BelowLeft);\n\t\t\t\tfindMoveOptions(this.board, this.repeat, NeighborType.AboveRight);\n\t\t\t}\n\n\t\t\t// apply additional validation logic\n\t\t\tthis.applySpecialValidation(opt);\n\n\t\t\t// callback\n\t\t\treturn callback(null, opt.destSquares);\n\t\t}\n\n\t\treturn callback(new Error('board is invalid'));\n\t}\n}\n\nexport class BishopValidation extends PieceValidation {\n\tconstructor (board) {\n\t\tsuper(board);\n\n\t\t// base validation properties\n\t\tthis.allowDiagonal = true;\n\t\tthis.type = PieceType.Bishop;\n\t\tthis.repeat = 8;\n\t}\n}\n\nexport class KingValidation extends PieceValidation {\n\tconstructor (board) {\n\t\tsuper(board);\n\n\t\t// base validation properties\n\t\tthis.allowBackward = true;\n\t\tthis.allowDiagonal = true;\n\t\tthis.allowForward = true;\n\t\tthis.allowHorizontal = true;\n\t\tthis.type = PieceType.King;\n\t\tthis.repeat = 1;\n\t}\n\n\tapplySpecialValidation () {\n\t\t// check for castle?\n\t}\n}\n\nexport class KnightValidation extends PieceValidation {\n\tconstructor (board) {\n\t\tsuper(board);\n\n\t\t// base validation properties\n\t\tthis.type = PieceType.Knight;\n\t\tthis.repeat = 1;\n\t}\n\n\tapplySpecialValidation (opt) {\n\t\t// add knight move options\n\t\tlet\n\t\t\taboveLeft = this.board.getNeighborSquare(\n\t\t\t\topt.origin,\n\t\t\t\tNeighborType.AboveLeft),\n\t\t\taboveRight = this.board.getNeighborSquare(\n\t\t\t\topt.origin,\n\t\t\t\tNeighborType.AboveRight),\n\t\t\tbelowLeft = this.board.getNeighborSquare(\n\t\t\t\topt.origin,\n\t\t\t\tNeighborType.BelowLeft),\n\t\t\tbelowRight = this.board.getNeighborSquare(\n\t\t\t\topt.origin,\n\t\t\t\tNeighborType.BelowRight),\n\t\t\ti = 0,\n\t\t\tp = null,\n\t\t\tsquares = [];\n\n\t\tif (aboveLeft) {\n\t\t\tsquares.push(this.board.getNeighborSquare(\n\t\t\t\taboveLeft,\n\t\t\t\tNeighborType.Above));\n\n\t\t\tsquares.push(this.board.getNeighborSquare(\n\t\t\t\taboveLeft,\n\t\t\t\tNeighborType.Left));\n\t\t}\n\n\t\tif (aboveRight) {\n\t\t\tsquares.push(this.board.getNeighborSquare(\n\t\t\t\taboveRight,\n\t\t\t\tNeighborType.Above));\n\n\t\t\tsquares.push(this.board.getNeighborSquare(\n\t\t\t\taboveRight,\n\t\t\t\tNeighborType.Right));\n\t\t}\n\n\t\tif (belowLeft) {\n\t\t\tsquares.push(this.board.getNeighborSquare(\n\t\t\t\tbelowLeft,\n\t\t\t\tNeighborType.Below));\n\n\t\t\tsquares.push(this.board.getNeighborSquare(\n\t\t\t\tbelowLeft,\n\t\t\t\tNeighborType.Left));\n\t\t}\n\n\t\tif (belowRight) {\n\t\t\tsquares.push(this.board.getNeighborSquare(\n\t\t\t\tbelowRight,\n\t\t\t\tNeighborType.Below));\n\n\t\t\tsquares.push(this.board.getNeighborSquare(\n\t\t\t\tbelowRight,\n\t\t\t\tNeighborType.Right));\n\t\t}\n\n\t\tfor (i = 0; i < squares.length; i++) {\n\t\t\tif (squares[i]) {\n\t\t\t\t// check for enemy piece on square\n\t\t\t\tp = squares[i] ? squares[i].piece : null;\n\t\t\t\tif (!p || p.side !== opt.piece.side) {\n\t\t\t\t\topt.destSquares.push(squares[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport class PawnValidation extends PieceValidation {\n\tconstructor (board) {\n\t\tsuper(board);\n\n\t\t// base validation properties\n\t\tthis.allowForward = true;\n\t\tthis.type = PieceType.Pawn;\n\t\tthis.repeat = 1;\n\t}\n\n\t/* eslint no-magic-numbers:0 */\n\tapplySpecialValidation (opt) {\n\t\t// check for capture\n\t\tlet\n\t\t\ti = 0,\n\t\t\tp = null,\n\t\t\tsq = null,\n\t\t\tsquares = [\n\t\t\t\tthis.board.getNeighborSquare(opt.origin,\n\t\t\t\t\topt.piece.side === SideType.White ?\n\t\t\t\t\t\t\tNeighborType.AboveLeft :\n\t\t\t\t\t\t\tNeighborType.BelowLeft),\n\t\t\t\tthis.board.getNeighborSquare(opt.origin,\n\t\t\t\t\topt.piece.side === SideType.White ?\n\t\t\t\t\t\t\tNeighborType.AboveRight :\n\t\t\t\t\t\t\tNeighborType.BelowRight)];\n\n\t\t// check for capture\n\t\tfor (i = 0; i < squares.length; i++) {\n\t\t\t// check for enemy piece on square\n\t\t\tp = squares[i] ? squares[i].piece : null;\n\t\t\tif (p && p.side !== opt.piece.side) {\n\t\t\t\topt.destSquares.push(squares[i]);\n\t\t\t}\n\t\t}\n\n\t\t// check for double square first move\n\t\tif (opt.piece.moveCount === 0 &&\n\t\t\t\topt.destSquares.length && // Fix for issue #15 (originally looked for length of 1)\n\t\t\t\topt.destSquares[0].piece === null) { // Fix for issue #1\n\t\t\tsq = this.board.getNeighborSquare(\n\t\t\t\topt.destSquares[0],\n\t\t\t\topt.piece.side === SideType.White ?\n\t\t\t\t\t\tNeighborType.Above :\n\t\t\t\t\t\tNeighborType.Below);\n\n\t\t\tif (!sq.piece) {\n\t\t\t\topt.destSquares.push(sq);\n\t\t\t}\n\n\t\t// check for en passant\n\t\t} else if (opt.origin.rank ===\n\t\t\t\t(opt.piece.side === SideType.White ? 5 : 4)) {\n\t\t\t// get squares left & right of pawn\n\t\t\tsquares = [\n\t\t\t\tthis.board.getNeighborSquare(opt.origin, NeighborType.Left),\n\t\t\t\tthis.board.getNeighborSquare(opt.origin, NeighborType.Right)];\n\t\t\ti = 0;\n\n\t\t\tfor (i = 0; i < squares.length; i++) {\n\t\t\t\t// check for pawn on square\n\t\t\t\tp = squares[i] ? squares[i].piece : null;\n\t\t\t\tif (p &&\n\t\t\t\t\t\tp.type === PieceType.Pawn &&\n\t\t\t\t\t\tp.side !== opt.piece.side &&\n\t\t\t\t\t\tp.moveCount === 1 &&\n\t\t\t\t\t\tthis.board.lastMovedPiece === p) {\n\n\t\t\t\t\topt.destSquares.push(\n\t\t\t\t\t\tthis.board.getNeighborSquare(\n\t\t\t\t\t\t\tsquares[i],\n\t\t\t\t\t\t\tp.side === SideType.Black ?\n\t\t\t\t\t\t\t\t\tNeighborType.Above :\n\t\t\t\t\t\t\t\t\tNeighborType.Below));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport class QueenValidation extends PieceValidation {\n\tconstructor (board) {\n\t\tsuper(board);\n\n\t\t// base validation properties\n\t\tthis.allowBackward = true;\n\t\tthis.allowDiagonal = true;\n\t\tthis.allowForward = true;\n\t\tthis.allowHorizontal = true;\n\t\tthis.repeat = 8;\n\t\tthis.type = PieceType.Queen;\n\t}\n}\n\nexport class RookValidation extends PieceValidation {\n\tconstructor (board) {\n\t\tsuper(board);\n\n\t\t// base validation properties\n\t\tthis.allowBackward = true;\n\t\tthis.allowForward = true;\n\t\tthis.allowHorizontal = true;\n\t\tthis.repeat = 8;\n\t\tthis.type = PieceType.Rook;\n\t}\n}\n\nexport default { PieceValidation };\n"]},"metadata":{},"sourceType":"script"}